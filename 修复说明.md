# P0 ä¿®å¤è¯´æ˜

## âœ… å·²å®Œæˆçš„ä¿®å¤

### 1. PageManager - æ·»åŠ  unmount ç”Ÿå‘½å‘¨æœŸå›è°ƒï¼ˆP0ï¼‰

**é—®é¢˜**: é¡µé¢åˆ‡æ¢æ—¶æ— æ³•é‡Šæ”¾èµ„æºï¼ˆå®šæ—¶å™¨ã€äº‹ä»¶ç›‘å¬ç­‰ï¼‰ï¼Œå¯¼è‡´èµ„æºæ³„æ¼å’Œ Ghost UI

**ä¿®å¤**: æ·»åŠ  `registerUnmountCallback` æ–¹æ³•ï¼Œé¡µé¢åˆ‡æ¢æ—¶è‡ªåŠ¨è°ƒç”¨ unmount å›è°ƒ

**ä½¿ç”¨ç¤ºä¾‹**:
```cpp
// åœ¨é¡µé¢åˆ›å»ºæ—¶æ³¨å†Œ unmount å›è°ƒ
PageManager::getInstance().registerUnmountCallback(Page::Home, []() {
    // æ¸…ç†å®šæ—¶å™¨
    // å–æ¶ˆäº‹ä»¶ç›‘å¬
    // é‡Šæ”¾å…¶ä»–èµ„æº
    PLOGI << "Home page unmounted, resources cleaned";
});

// åˆ‡æ¢é¡µé¢æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨å¯¹åº”é¡µé¢çš„ unmount å›è°ƒ
PageManager::getInstance().switchTo(Page::History);
// Home é¡µé¢çš„ unmount å›è°ƒä¼šè‡ªåŠ¨æ‰§è¡Œ
```

**ä»£ç å˜æ›´**:
- `src/ui/page_manager.h`: æ·»åŠ  `UnmountCallback` ç±»å‹å’Œ `registerUnmountCallback` æ–¹æ³•
- `src/ui/page_manager.cpp`: åœ¨ `switchTo` ä¸­è°ƒç”¨ unmount å›è°ƒ

---

### 2. SDL flush ä¼˜åŒ–ï¼ˆP0ï¼‰

**é—®é¢˜**: flush å‡½æ•°ä»æœ‰ä¼˜åŒ–ç©ºé—´ï¼Œé¢œè‰²è½¬æ¢é€»è¾‘å¯ç®€åŒ–

**ä¿®å¤**: åˆ©ç”¨ full_refresh ç‰¹æ€§ï¼Œç›´æ¥å…¨å±æ›´æ–°ï¼Œç®€åŒ–é€»è¾‘

**ä¼˜åŒ–ç‚¹**:
- âœ… å»é™¤åŒºåŸŸè®¡ç®—ï¼ˆfull_refresh æ—¶æ€»æ˜¯å…¨å±ï¼‰
- âœ… å›ºå®š pitch è®¡ç®—ï¼ˆå…¨å±å®½åº¦ * 4ï¼‰
- âœ… æ‰¹é‡é¢œè‰²è½¬æ¢ï¼ˆå…¨å±ä¸€æ¬¡æ€§è½¬æ¢ï¼‰
- âœ… ç®€åŒ–é”™è¯¯å¤„ç†ï¼ˆå‡å°‘ä¸å¿…è¦çš„æ£€æŸ¥ï¼‰

**æ€§èƒ½æå‡**:
- å‡å°‘æ¡ä»¶åˆ¤æ–­
- å›ºå®šå†…å­˜è®¿é—®æ¨¡å¼ï¼ˆæ›´å¥½çš„ç¼“å­˜å±€éƒ¨æ€§ï¼‰
- ä»£ç æ›´ç®€æ´ï¼Œæ˜“äºç»´æŠ¤

**ä»£ç å˜æ›´**:
- `src/sdl/sdl.cpp`: ç®€åŒ– `sdl_display_flush` å‡½æ•°

---

## ğŸ“Š ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰çš„é—®é¢˜
1. âŒ é¡µé¢åˆ‡æ¢æ—¶èµ„æºæ— æ³•é‡Šæ”¾
2. âŒ flush å‡½æ•°é€»è¾‘å¤æ‚ï¼Œæœ‰ä¼˜åŒ–ç©ºé—´
3. âŒ å¯èƒ½å‡ºç° Ghost UIï¼ˆæ—§å¯¹è±¡æ®‹ç•™ï¼‰

### ä¿®å¤åçš„æ”¹è¿›
1. âœ… é¡µé¢åˆ‡æ¢æ—¶è‡ªåŠ¨æ¸…ç†èµ„æº
2. âœ… flush å‡½æ•°æ›´ç®€æ´é«˜æ•ˆ
3. âœ… é¿å…èµ„æºæ³„æ¼å’Œ UI æ®‹ç•™

---

## ğŸš€ ä¸‹ä¸€æ­¥å»ºè®®

### å¯é€‰ä¼˜åŒ–ï¼ˆP1ï¼‰
1. **é›†æˆ PageLifecycle**: è®© PageManager ä½¿ç”¨å·²æœ‰çš„ PageLifecycle ç±»ï¼Œç»Ÿä¸€ç”Ÿå‘½å‘¨æœŸç®¡ç†
2. **ä¸»å¾ªç¯å°è£…**: å°† SDL ä¸»å¾ªç¯é€»è¾‘å°è£…åˆ°å¹³å°å±‚ï¼Œæå‡å¯è¯»æ€§

### æœªæ¥é‡æ„ï¼ˆP2ï¼‰
1. **SDL å±‚æ‹†åˆ†**: å°†çª—å£/æ¸²æŸ“/è¾“å…¥æ‹†åˆ†ä¸ºç‹¬ç«‹æ¨¡å—ï¼Œä¸º F133 è¿ç§»åšå‡†å¤‡

---

## âœ… éªŒè¯æ–¹æ³•

1. **æµ‹è¯•é¡µé¢åˆ‡æ¢**:
   ```cpp
   // åˆ›å»ºé¡µé¢æ—¶æ³¨å†Œå›è°ƒ
   PageManager::getInstance().registerUnmountCallback(Page::Home, []() {
       std::cout << "Home page unmounted\n";
   });
   
   // åˆ‡æ¢é¡µé¢ï¼Œåº”è¯¥çœ‹åˆ° unmount æ—¥å¿—
   PageManager::getInstance().switchTo(Page::History);
   ```

2. **éªŒè¯ flush æ€§èƒ½**:
   - è¿è¡Œç¨‹åºï¼Œè§‚å¯Ÿæ§åˆ¶å°æ—¥å¿—
   - flush åº”è¯¥æ›´å¿«é€Ÿï¼Œæ—¥å¿—æ›´ç®€æ´

---

## ğŸ“ æ€»ç»“

**æœ¬æ¬¡ä¿®å¤è§£å†³äº†ä¸¤ä¸ªå…³é”®é—®é¢˜**:
1. âœ… é¡µé¢ç”Ÿå‘½å‘¨æœŸä¸å®Œæ•´ â†’ æ·»åŠ  unmount æœºåˆ¶
2. âœ… flush å‡½æ•°å¯ä¼˜åŒ– â†’ ç®€åŒ–å¹¶åˆ©ç”¨ full_refresh

**ä¿®å¤çº§åˆ«**: ä¿®æ­£çº§ï¼ˆéè¿”å·¥çº§ï¼‰  
**å½±å“èŒƒå›´**: å±€éƒ¨ä¼˜åŒ–ï¼Œä¸å½±å“æ ¸å¿ƒæ¶æ„  
**å‘åå…¼å®¹**: å®Œå…¨å…¼å®¹ï¼Œç°æœ‰ä»£ç æ— éœ€ä¿®æ”¹

**ä½ çš„æ¶æ„æ–¹å‘æ˜¯æ­£ç¡®çš„ï¼Œè¿™äº›ä¿®å¤è®©ä»£ç æ›´åŠ å¥å£®å’Œé«˜æ•ˆï¼** ğŸ‰



