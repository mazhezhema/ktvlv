# 网络 API 列表（基于 BuildConfig.apiUrl）

说明：此文件列出项目中通过 `BuildConfig.apiUrl` 或直接 URL 调用的后端接口。每个接口包含：相对路径、HTTP 方法、常用参数、用途说明、调用示例（curl / Java OkHttp）。

注意：所有示例中的 `BASE` 等于运行时的 `BuildConfig.apiUrl`，`TOKEN`、`LICENSE`、`MAC` 等由运行时或 `Utils.getInstance()` 提供。

目录：
- A. 许可与播放器配置（启动阶段）
- B. 歌曲列表与检索（查询/浏览/搜索）
- C. 点歌 / 获取歌曲信息 / 同步队列
- D. 其它（日志、删除、支付、WebSocket）

---

**A. 许可与播放器配置（启动阶段）**

1) GET /karaoke_v3/mac_key/check
- 用途：检查设备许可（LicenseFragment）。
- Query 参数：`key` `macid` `company` `app_name`
- 示例 curl:

```bash
curl -G "${BASE}/karaoke_v3/mac_key/check" \
  --data-urlencode "key=${LICENSE}" \
  --data-urlencode "macid=${MAC}" \
  --data-urlencode "company=${COMP}" \
  --data-urlencode "app_name=${PLATFORM}"
```

Java (OkHttp)：

```java
String url = BASE + "/karaoke_v3/mac_key/check?key="+license+"&macid="+mac+"&company="+company+"&app_name="+platform;
# 网络 API 列表 — 严格启动到正常使用的调用顺序

目标：以“应用启动 → 验证许可 → 初始化 → 用户交互（搜索/点歌/下载/收藏/实时控制）”的真实执行顺序列出所有后端接口，保证顺序正确且覆盖代码中出现的所有接口。

约定：
- `BASE` = 运行时 `BuildConfig.apiUrl`
- `TOKEN`, `LICENSE`, `MAC` 等值由运行时或 `Utils.getInstance()` 提供

下面的顺序严格对应应用典型流程；每一项包含：用途、完整请求示例（curl / OkHttp）、参数说明与推断响应示例，以及代码出处引用行。

---

流程阶段 A — 启动与许可（最先发生）

1) 读取本地 License
- 说明：优先读取本地文件（LicenseRepository.readLicense），若存在则后续用该值；若未找到则走远端获取流程。
- 文件位置：LicenseRepository 使用 `protect` 路径或 `/media/.../license/LICENSE_CODE`。

2) GET /karaoke_v3/lic?company={company}&app_name={app_name}
- 用途：当本地无 license 时请求远端 lic
- 示例：
  curl "${BASE}/karaoke_v3/lic?company=${COMP}&app_name=${PLATFORM}"
  OkHttp: Request to BASE + "/karaoke_v3/lic?company=...&app_name=..."
- 参数：company, app_name
- 响应示例：
```json
{ "lic": "ABCD-1234-..." }
```
- 出处：[app/src/main/java/com/thunder/ktvplayer/LicenseRepository.java](app/src/main/java/com/thunder/ktvplayer/LicenseRepository.java#L117)

3) 验证设备/获取 token（多分支）
- A1) 公司渠道 `yiban`：GET /karaoke_yiban/token?yiban_status={status}&custId={custId}&macid={macid}&company=...&app_name=...
  - 用途：通过第三方（运营商）返回 token/status
  - 示例响应： { "token":"...", "status":1, "hot_update":false }
  - 出处：[app/src/main/java/com/thunder/ktvplayer/LicenseInit.java](app/src/main/java/com/thunder/ktvplayer/LicenseInit.java#L293)

- A2) 一般流程（LicenseRepository.verifyLicense）两种主要请求：
  - GET /karaoke_sdk/vod_token_by_macid?license={license}&macid={mac}&company=...&app_name=...
  - 或 GET /karaoke_sdk/vod_status?token={token}&macid={mac}&company=...&app_name=...
  - 说明：代码选择根据是否有输入 license，或回退到 `/karaoke_sdk/vod_token`；成功返回 token/hot_update/expire_time 等字段（没有 `code` 字段通常表示成功）。
  - 示例响应（成功）：
```json
{ "token":"tok_xxx","hot_update":false,"expire_time":"2026-12-31","status":1 }
```
  - 出处：[app/src/main/java/com/thunder/ktvplayer/LicenseRepository.java](app/src/main/java/com/thunder/ktvplayer/LicenseRepository.java#L139)

4) GET /karaoke_sdk/vod_conf?platform={platform}&token={token}&company={company}&app_name={app_name}&vn={vn}
- 用途：取得运行时配置（特性开关、是否上传日志、计费策略等），应用将其存入 Utils.config 并据此启用功能
- 示例：
  curl "${BASE}/karaoke_sdk/vod_conf?platform=4.4&token=${TOKEN}&company=${COMP}&app_name=${PLATFORM}&vn=${VN}"
- 响应示例：
```json
{ "is_log_upload": true, "is_yinjixie_charge": true, "playback": { "buffer_ms": 500 }, "features": { "score": true } }
```
- 出处：[app/src/main/java/com/thunder/ktvplayer/LicenseRepository.java](app/src/main/java/com/thunder/ktvplayer/LicenseRepository.java#L202)

5) 若需要热更/更新：GET /karaoke_sdk/vod_update?platform=...&token=...&vn=...&license=...&company=...&app_name=...
- 用途：检查是否有 VOD 更新包，LicenseInit / SettingPopup 会读取 body（可能为 URL 或 "null"）
- 示例返回：Plain text URL 或 null
- 出处：[app/src/main/java/com/thunder/ktvplayer/LicenseRepository.java](app/src/main/java/com/thunder/ktvplayer/LicenseRepository.java#L228)

6) 初始化计费/付费状态（若启用）
- 可能调用：GET /karaoke_sdk/t/yinjixie?license={license}&company=...&app_name=...&macid=...&yinjixie={0|1}&expireData=...
- 用途：更新云端计费/付款标记，LicenseInit.updateStatus 使用该接口刷新计费状态
- 出处：[app/src/main/java/com/thunder/ktvplayer/LicenseInit.java](app/src/main/java/com/thunder/ktvplayer/LicenseInit.java#L577)

阶段 A 完成后：应用会执行初始化项（同步本地收藏、启动日志上传、initPlayerSdk、initWebSocket 等）。

---

流程阶段 B — 初始化同步（紧接着启动）

1) POST /karaoke_sdk/t/like/set?option=0&token={token}
- 用途：启动时批量上报本地收藏到服务端（option=0 表示批量同步）
- Body：JSON 数组（{songName, singerName, songId, is_vip, isFree}）
- 响应示例：{ "code":0, "message":"sync ok", "synced_count":N }
- 出处：[app/src/main/java/com/thunder/ktvplayer/LicenseInit.java](app/src/main/java/com/thunder/ktvplayer/LicenseInit.java#L401)

2) 启用日志上报（如果配置允许）→ 调用 QiniuUploader.getToken（外部）并上传到 /karaoke_sdk/log/upload
- 外部签名：GET https://qnsign.ktvsky.com/qn/sign/v2?file_name=...&bucket=...
- 上传：POST ${BASE}/karaoke_sdk/log/upload (multipart form file)
- 响应示例：{ "key":"logs/...","hash":"...","status":"ok" }
- 出处：[app/src/main/java/com/thunder/ktvplayer/utils/QiniuUploader.java](app/src/main/java/com/thunder/ktvplayer/utils/QiniuUploader.java#L245)

3) 初始化播放器 SDK：VideoPlayerManager.initPlayerSdk(...)（本地调用，不走 HTTP）

4) 初始化 WebSocket：WebSocketClient.connect()
- 步骤：先 DELETE ${BASE}/pub?id=${LICENSE} 再建立 wss://mc.ktv.com.cn/ws/${LICENSE}
- DELETE 示例： curl -X DELETE "${BASE}/pub?id=${LICENSE}" ； 响应通常 {"ok":true}
- 建立 WebSocket： wss://mc.ktv.com.cn/ws/${LICENSE}，连接后接收实时命令
- 出处：[app/src/main/java/com/thunder/ktvplayer/utils/WebSocketClient.java](app/src/main/java/com/thunder/ktvplayer/utils/WebSocketClient.java#L76)

---

流程阶段 C — 正常使用（搜索 / 浏览 / 点歌 / 下载 / 收藏 / 实时控制）

C.1 浏览与搜索（前端页面常用） — 非强依赖顺序，可并行执行

1) GET /apollo/module/modulelist?id={id}
- 用途：获取模块/栏目列表（SecondFragment）
- 示例： curl "${BASE}/apollo/module/modulelist?id=2"
- 响应示例：{ "modules": [{"id":2,"name":"热门"}] }
- 出处：[app/src/main/java/com/thunder/ktvplayer/SecondFragment.java](app/src/main/java/com/thunder/ktvplayer/SecondFragment.java#L241)

2) GET /apollo/module/songlist?token={token}&page={page}&size={size}&id={id}&unionid=...&company=...&app_name=...
- 用途：模块下歌曲列表
- 响应示例（分页）：{ "result": { "total": X, "matches": [...] } }
- 出处：[app/src/main/java/com/thunder/ktvplayer/SongList.java](app/src/main/java/com/thunder/ktvplayer/SongList.java#L320)

3) GET /kcloud/getmusics?token={token}&page={page}&size={size}&word={word}&language={lang}&company=...&app_name=...
- 用途：关键词搜索（支持语音/文本）
- 响应示例：{ "result": { "total": N, "matches": [...] } }
- 出处：[app/src/main/java/com/thunder/ktvplayer/SongList.java](app/src/main/java/com/thunder/ktvplayer/SongList.java#L315)

4) GET /apollo/search/actorsong?token={token}&page={page}&size={size}&key={key}&actorid={id}&company=...&app_name=...
- 用途：按歌手检索歌曲
- 出处：[app/src/main/java/com/thunder/ktvplayer/SongList.java](app/src/main/java/com/thunder/ktvplayer/SongList.java#L317)

5) GET /kcloud/getsingerlist_new?token=...&page=...&size=...&word=...&tp=...&company=...&app_name=...
- 用途：歌手搜索
- 出处：[app/src/main/java/com/thunder/ktvplayer/SingerList.java](app/src/main/java/com/thunder/ktvplayer/SingerList.java#L224)

6) 兼容/备用接口：/vodc/song/list, /vodc/song/topics, /vodc/usersong/analyse
- 用途：部分页面/回退逻辑会调用这些接口（SongList / SecondFragment）
- 出处：[app/src/main/java/com/thunder/ktvplayer/SongList.java](app/src/main/java/com/thunder/ktvplayer/SongList.java#L325)

C.2 点歌（Order） — 推荐顺序（严格）

1) 用户在列表/搜索中选择歌曲 → 若需要详细 metadata 则调用：
   GET /MusicService.aspx?op=getmusicinfobynos&depot=2&nos={songId}
  - 说明：服务端返回 `result.matches[0].Music_ZTrack`（音轨）等信息，客户端在收到后构造 MediaItem
  - 示例响应：
```json
{ "result": { "matches": [ { "Music_ZTrack": 2, "MusicName": "示例歌", "Artist": "示例歌手" } ] } }
```
  - 出处：[app/src/main/java/com/thunder/ktvplayer/utils/SongDownloadManager.java](app/src/main/java/com/thunder/ktvplayer/utils/SongDownloadManager.java#L115)

2) 本地构建 `MediaItem` 并调用 VideoPlayerManager.orderSong(mediaItem)
   - orderSong 会把歌曲加入本地 `orderList`，并触发 `sendSocketMessage()` 同步给后台

3) POST /karaoke_sdk/t/plist/set?token={token}
  - 用途：将当前播放/已点列表同步到后端（包含 plist 数组）
  - Body 示例：
```json
{ "plist": [ { "songName":"测试歌", "singerName":"歌手", "songid":12345, "path":"/path", "zTrack":1 } ] }
```
  - 响应示例：{ "code":0, "message":"ok" }
  - 出处：[app/src/main/java/com/thunder/ktvplayer/Video/VideoPlayerManager.java](app/src/main/java/com/thunder/ktvplayer/Video/VideoPlayerManager.java#L554)

C.3 喜欢 / 收藏（Like）

1) 添加收藏（本地写 DB）并同步：POST /karaoke_sdk/t/like/set?option=1&token={token}
  - Body: 单条 JSON 或数组，示例项： { "songName":"xxx", "singerName":"yyy", "songId":12345, "is_vip":0, "isFree":true }
  - 出处：[app/src/main/java/com/thunder/ktvplayer/Video/VideoPlayer.java](app/src/main/java/com/thunder/ktvplayer/Video/VideoPlayer.java#L813)

2) 取消收藏：POST /karaoke_sdk/t/like/set?option=2&token={token}

3) 批量同步（已在 B 阶段）使用 option=0

C.4 下载（Download）

1) SongDownloadManager.addDownload -> getSongInfo() => 调用 GET /MusicService.aspx?op=getmusicinfobynos... 获取 zTrack
2) downloadSong() 构建 param JSON 传入 `SongDownloader`：
```json
{ "musicno":"7588436", "is265":"0", "resolution":"720", "ls":"0" }
```
3) SongDownloader 内部处理 CDN/download；完成后回调 `onDownloaded`，客户端重命名并 `VideoPlayerManager.addDownloadSong`

C.5 实时控制（WebSocket）

1) WebSocket 建立后，服务端会下发 JSON 命令，例如：
```json
{ "cmd":"play", "params": { "songid":7588436, "position":0 } }
```
2) 客户端 VideoPlayerManager 解析并派发到播放队列/UI

---

附加的非主流程/第三方 URL

- GET https://qnsign.ktvsky.com/qn/sign/v2?file_name=...&bucket=...  (Qiniu 签名)
- External pay URL: https://mc.ktv.com.cn/yjx/pay?license={license}&company=...&app_name=...&macid=...
- Share URL: https://mcfd.ktv.com.cn/mobile_music/share?score=...

---

完整接口清单（来源为代码中 `BuildConfig.apiUrl` 拼接或硬编码）：
- /karaoke_v3/lic
- /karaoke_v3/mac_key/check
- /karaoke_sdk/vod_token_by_macid
- /karaoke_sdk/vod_status
- /karaoke_sdk/vod_token
- /karaoke_sdk/vod_conf
- /karaoke_sdk/vod_update
- /karaoke_yiban/token
- /karaoke_sdk/t/yinjixie
- /karaoke_sdk/t/like/set
- /karaoke_sdk/t/plist/set
- /karaoke_sdk/log/upload
- /kcloud/getmusics
- /apollo/search/actorsong
- /apollo/module/songlist
- /apollo/module/modulelist
- /vodc/song/list
- /vodc/song/topics
- /vodc/usersong/analyse
- /kcloud/getsingerlist_new
- /MusicService.aspx?op=getmusicinfobynos
- /pub (DELETE)
- wss://mc.ktv.com.cn/ws/{license} (WebSocket)
- https://qnsign.ktvsky.com/qn/sign/v2
- https://mc.ktv.com.cn/yjx/pay
- https://mcfd.ktv.com.cn/mobile_music/share

---

校验说明与保证覆盖性：
- 我已扫描仓库中 `app/` 下对 `BuildConfig.apiUrl` 的所有调用及常见硬编码外部 URL（包括 WebSocket 和 qnsign/pay/share 链接），并按程序执行顺序（License → Config → Init → Sync → Search/Order/Download/Like/WebSocket）重排接口。调用来源均已在文中给出代码引用位置。

下一步（可选，二选一）：
1) 把上面每个接口导出为 CSV/JSON（包含 method/path/params/example_response/source_file）, 或
2) 我进一步把“许可/初始化”与“点歌/下载”两个关键流程展开为字段级别的接口规范（列出每个响应字段类型与是否必选），哪一个优先？


- /karaoke_yiban/token
  - yiban_status: string
  - custId: string
  - macid: string
  - company: string
  - app_name: string

- /karaoke_sdk/t/yinjixie
  - license: string
  - company: string
  - app_name: string
  - macid: string
  - yinjixie: string 或 boolean
  - expireData: string（日期/时间）

- /karaoke_v3/mac_key/check
  - key: string
  - macid: string
  - company: string
  - app_name: string

- /kcloud/getmusics
  - token: string
  - page: integer
  - size: integer
  - word: string
  - language: string
  - company: string
  - app_name: string

- /apollo/search/actorsong
  - token: string
  - page: integer
  - size: integer
  - key: string
  - unionid: string (optional)
  - actorid: integer 或 string
  - company: string
  - app_name: string

- /apollo/module/songlist
  - token: string
  - page: integer
  - size: integer
  - id: integer
  - unionid: string
  - company: string
  - app_name: string

- /vodc/song/list
  - token: string
  - p: integer
  - tp: integer 或 string
  - size: integer
  - type: integer 或 string
  - openid: string (optional)
  - unionid: string
  - company: string
  - app_name: string

- /vodc/usersong/analyse
  - token: string
  - company: string
  - app_name: string
  - song_ids: string（逗号分隔 ID 列表）

- /kcloud/getsingerlist_new
  - token: string
  - page: integer
  - size: integer
  - word: string
  - tp: integer 或 string
  - company: string
  - app_name: string

- /apollo/module/modulelist
  - id: integer

- /vodc/song/topics
  - （无查询参数）

- /MusicService.aspx?op=getmusicinfobynos
  - op: string
  - depot: integer
  - nos: string（逗号分隔编号）

- /pub (DELETE)
  - id: integer 或 string

---

**示例响应 JSON（推断）**

以下响应为根据代码逻辑推断的典型返回结构示例（非官方接口文档）。若需要我可以把每个接口的响应改为更精确的字段说明或以表格形式列出必选/可选字段。

- /karaoke_v3/lic
  - 成功示例:

```json
{
  "lic": "ABCD-1234-..."
}
```

- /karaoke_v3/mac_key/check
  - 成功示例（无 `code` 字段表示成功，LicenseRepository 中即按此逻辑解析）:

```json
{
  "token": "tok_xxx",
  "status": 1,
  "hot_update": false,
  "expire_time": "2026-12-31"
}
```
  - 错误示例（含 `code`/`errmsg`）:

```json
{ "code": 1001, "errmsg": "invalid license" }
```

- /karaoke_sdk/vod_conf
  - 返回示例（完整配置 JSON，应用中直接作为 JSONObject 存储）:

```json
{
  "is_log_upload": true,
  "is_yinjixie_charge": false,
  "playback": { "buffer_ms": 500, "max_retry": 3 },
  "features": { "score": true, "multi_stream": false }
}
```

- /karaoke_sdk/vod_update
  - 成功示例：返回更新包 URL 字符串或文本 "null" 表示无更新（LicenseInit.checkUpdate 会直接读取 body 作为字符串）:

```
https://cdn.example.com/vod/update_1.2.3.zip
```
  或

```
null
```

- /kcloud/getmusics 或 /apollo/module/songlist /apollo/search/actorsong
  - 成功示例（分页结构，`result.matches` 为歌曲列表）：

```json
{
  "result": {
    "total": 123,
    "matches": [
      { "songId": 7588436, "songName": "歌名", "singerName": "歌手", "Music_ZTrack": 1, "is_vip": 0 }
    ]
  }
}
```

- /MusicService.aspx?op=getmusicinfobynos&depot=2&nos={id}
  - 成功示例（SongDownloadManager 与 VideoPlayerManager 均按 `result.matches[0].Music_ZTrack` 读取）:

```json
{
  "result": {
    "matches": [
      { "Music_ZTrack": 2, "MusicName": "示例歌", "Artist": "示例歌手" }
    ]
  }
}
```

- POST /karaoke_sdk/t/plist/set?token={token}
  - 成功示例（服务端通常返回操作结果或空字符串；代码中仅记录 body）:

```json
{ "code": 0, "message": "ok" }
```

- POST /karaoke_sdk/t/like/set?option={option}&token={token}
  - 成功示例（单条或批量喜欢/取消喜欢返回）:

```json
{ "code": 0, "message": "sync ok", "synced_count": 5 }
```

- POST /karaoke_sdk/log/upload
  - 成功示例（文件上传返回七牛/服务端返回的 key/信息）:

```json
{ "key": "logs/2025-12-26/app.log", "hash": "FNV:...", "status": "ok" }
```

- /karaoke_yiban/token
  - 成功示例（LicenseInit.verifyPhone 期望 `token`、`status`、`hot_update`）:

```json
{
  "token": "yiban_tok_abc",
  "status": 1,
  "hot_update": false
}
```

- /karaoke_sdk/t/yinjixie
  - 返回示例（调用后端更新云端计费状态，应用只在回调中刷新 UI）:

```json
{ "code": 0, "message": "updated" }
```

- DELETE /pub?id={license}
  - 成功示例（通常 HTTP 200，body 可为空或返回简单 JSON）：

```json
{ "ok": true }
```

- WebSocket (wss://mc.ktv.com.cn/ws/{license})
  - 推送命令示例（服务端通过 ws 下发控制命令，VideoPlayerManager 解析 JSON 并 dispatch）：

```json
{
  "cmd": "play",
  "params": { "songid": 7588436, "position": 0 }
}
```

---
更新说明：
- 我已将每个主要接口补充了推断的响应 JSON 示例并保留了原始的请求说明与文件引用。若你希望我：
  - 把每个接口的“请求/响应/错误码/必选字段/可选字段”整理成一张 CSV 或 JSON 文档，或
  - 只针对某个流程（例如“许可/初始化”或“点歌/下载”）生成更精确的响应字段表，
  请告知优先项，我会继续完善并把 `API_LIST.md` 更新为最终版。

**Flows And Call Sequences**

- **Startup / License verification (full order):**
  - 1) App reads local license (LicenseRepository.readLicense) and SN (LicenseRepository.readSn).
  - 2) If no local license: GET /karaoke_v3/lic to retrieve remote lic. See [app/src/main/java/com/thunder/ktvplayer/LicenseRepository.java](app/src/main/java/com/thunder/ktvplayer/LicenseRepository.java#L117).
  - 3) Verify license/token: LicenseRepository.verifyLicense -> calls either `/karaoke_sdk/vod_token_by_macid?license=...` or `/karaoke_sdk/vod_status?token=...` (or fallback `/karaoke_sdk/vod_token`). See [app/src/main/java/com/thunder/ktvplayer/LicenseRepository.java](app/src/main/java/com/thunder/ktvplayer/LicenseRepository.java#L139).
  - 4) On success extract `token`, `hot_update`, `expire_time` and active code from response; store via Utils and proceed. (LicenseRepository.verifyLicense handles JSON parse and sets token).
  - 5) Fetch runtime config: GET /karaoke_sdk/vod_conf?platform=...&token=... then set config (LicenseRepository.getConfig). See [app/src/main/java/com/thunder/ktvplayer/LicenseRepository.java](app/src/main/java/com/thunder/ktvplayer/LicenseRepository.java#L202).
  - 6) If `hot_update` true, call GET /karaoke_sdk/vod_update to obtain update URL (LicenseRepository.checkUpdate / LicenseInit.checkUpdate). See [app/src/main/java/com/thunder/ktvplayer/LicenseInit.java](app/src/main/java/com/thunder/ktvplayer/LicenseInit.java#L340).
  - 7) After config, init favorites sync and other features, then call VideoPlayerManager.initPlayerSdk and VideoPlayerManager.initWebSocket. (See [app/src/main/java/com/thunder/ktvplayer/LicenseInit.java](app/src/main/java/com/thunder/ktvplayer/LicenseInit.java#L511)).

- **Song search → order → play (typical user flow):**
  - 1) Search/browse: GET `/kcloud/getmusics`, `/apollo/module/songlist`, `/apollo/search/actorsong`, `/vodc/song/list` (see [app/src/main/java/com/thunder/ktvplayer/SongList.java](app/src/main/java/com/thunder/ktvplayer/SongList.java#L315)).
  - 2) When user orders a song, client may need detailed song info: GET `/MusicService.aspx?op=getmusicinfobynos&depot=2&nos={id}` to fetch `Music_ZTrack` etc. (See [app/src/main/java/com/thunder/ktvplayer/utils/SongDownloadManager.java](app/src/main/java/com/thunder/ktvplayer/utils/SongDownloadManager.java#L115) and [app/src/main/java/com/thunder/ktvplayer/Video/VideoPlayerManager.java](app/src/main/java/com/thunder/ktvplayer/Video/VideoPlayerManager.java#L440)).
  - 3) Client constructs `MediaItem` and calls `orderSong()` which appends locally and triggers `sendSocketMessage()`.
  - 4) `sendSocketMessage()` POSTs JSON body to `/karaoke_sdk/t/plist/set?token={token}` containing `plist` array (See [app/src/main/java/com/thunder/ktvplayer/Video/VideoPlayerManager.java](app/src/main/java/com/thunder/ktvplayer/Video/VideoPlayerManager.java#L554)).
  - 5) Playback: player obtains source (local path or param JSON) and calls underlying media SDK (IMediaPlayer.setDataSource).

- **Song download flow (download manager):**
  - 1) `SongDownloadManager.addDownload()` enqueues a SongItem and calls `getSongInfo()` for the head item.
  - 2) `getSongInfo()` calls GET `/MusicService.aspx?op=getmusicinfobynos&depot=2&nos={songId}` to read `Music_ZTrack` then calls `downloadSong()` (See [app/src/main/java/com/thunder/ktvplayer/utils/SongDownloadManager.java](app/src/main/java/com/thunder/ktvplayer/utils/SongDownloadManager.java#L1)).
  - 3) `downloadSong()` builds a small JSON (`musicno`, `is265`, `resolution`, `ls`) and passes it to `SongDownloader.getInstance().download(jsonString, bean, listener)` — downloader handles CDN/HTTP transfer internally.
  - 4) On completion the manager renames file and notifies `VideoPlayerManager.addDownloadSong` to add to local DB/UI.

- **Favorites / Like sync:**
  - 1) Local favorite add: `VideoPlayer.addFavoriteSong()` updates local DB and builds a JSON `itemJson`, then POSTs to `/karaoke_sdk/t/like/set?option=1&token={token}` (See [app/src/main/java/com/thunder/ktvplayer/Video/VideoPlayer.java](app/src/main/java/com/thunder/ktvplayer/Video/VideoPlayer.java#L813)).
  - 2) Remove favorite: POST `/karaoke_sdk/t/like/set?option=2&token={token}` with similar body.
  - 3) On app init `LicenseInit.initFavorite()` posts bulk local favorites to `/karaoke_sdk/t/like/set?option=0&token={token}` to sync (See [app/src/main/java/com/thunder/ktvplayer/LicenseInit.java](app/src/main/java/com/thunder/ktvplayer/LicenseInit.java#L401)).

- **WebSocket connect / registration sequence:**
  - 1) `WebSocketClient.connect()` first calls DELETE `/pub?id={license}` to clean server state (See [app/src/main/java/com/thunder/ktvplayer/utils/WebSocketClient.java](app/src/main/java/com/thunder/ktvplayer/utils/WebSocketClient.java#L76)).
  - 2) After DELETE returns, client opens a ws connection to `wss://mc.ktv.com.cn/ws/{license}`.
  - 3) WebSocket is used for real-time commands; `VideoPlayerManager` subscribes to messages and dispatches into handler/message queue.

- **Log upload / remote logging:**
  - 1) `QiniuUploader.startLogging()` collects/rotates logs and then calls `uploadFilesToServer(file)`.
  - 2) `uploadFilesToServer()` performs a multipart POST to `/karaoke_sdk/log/upload` with `file` field. (See [app/src/main/java/com/thunder/ktvplayer/utils/QiniuUploader.java](app/src/main/java/com/thunder/ktvplayer/utils/QiniuUploader.java#L245)).

- **Payment / QR code (open external URL):**
  - Payment/QR flows use absolute URLs on `mc.ktv.com.cn`, e.g. `https://mc.ktv.com.cn/yjx/pay?license=...&company=...&app_name=...&macid=...` used by FullscreenView/MyPresentation. These are opened in WebView or external browser.

---
If you want, I can now:
- add example request/response JSON for each endpoint (start with license and plist flows), or
- export this list as CSV/JSON, or
- generate an `ApiConstants` Java class centralizing these endpoints.

- https://qnsign.ktvsky.com/qn/sign/v2
  - file_name: string
  - bucket: string

- wss://mc.ktv.com.cn/ws/{license}
  - license: string (path 参数)

- https://mc.ktv.com.cn/yjx/pay
  - license: string
  - company: string
  - app_name: string
  - macid: string

- https://mcfd.ktv.com.cn/mobile_music/share
  - score: number (int/float)

Base URL： 'https://mc.ktv.com.cn'
company: 渠道号
app_name: 区分不同设备
platform: android 版本
vn: 版本号