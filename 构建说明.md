# KTVLV 构建说明

## 快速构建

### 方式一：使用构建脚本（推荐）

直接运行构建脚本：

```bash
.\build_exe.bat
```

该脚本会：
- ✅ 自动检测 Visual Studio 安装路径（使用 vswhere 或手动检测）
- ✅ 自动初始化 MSVC 编译环境
- ✅ 使用 8 个并行任务加速编译
- ✅ 自动验证构建结果
- ✅ 显示生成的 exe 文件和依赖 DLL 信息

### 方式二：使用 PowerShell 脚本

```powershell
.\build.ps1
```

### 方式三：手动构建

如果构建目录已存在，可以直接执行：

```bash
cd build_ninja2
cmake --build . --config Release --target ktvlv --parallel 8
```

## 首次构建（完整配置）

如果是首次构建或需要重新配置，需要先运行 CMake 配置：

```bash
cmake -S . -B build_ninja2 ^
  -G Ninja ^
  -DCMAKE_TOOLCHAIN_FILE=D:/vcpkg/scripts/buildsystems/vcpkg.cmake ^
  -DVCPKG_TARGET_TRIPLET=x64-windows ^
  -DCMAKE_BUILD_TYPE=Release
```

然后运行构建脚本或手动构建。

## 构建输出

构建成功后，exe 文件位于：
```
build_ninja2\ktvlv.exe
```

依赖 DLL 会自动复制到同一目录：
- `SDL2.dll`
- `libcurl.dll`
- `zlib1.dll`

## 运行程序

直接运行：
```bash
cd build_ninja2
.\ktvlv.exe
```

或从项目根目录：
```bash
.\build_ninja2\ktvlv.exe
```

## 环境要求

- **Visual Studio**: 2019 或 2022（包含 C++ 桌面开发组件）
- **CMake**: 3.20 或更高版本
- **Ninja**: 构建系统（通常随 Visual Studio 安装）
- **vcpkg**: 依赖包管理器（路径：`D:/vcpkg`）

## 常见问题

### 找不到 Visual Studio

构建脚本会自动检测，如果失败：
1. 确认已安装 Visual Studio 2019 或 2022
2. 确认包含 "Desktop development with C++" 工作负载
3. 手动修改 `build_exe.bat` 中的路径

### 找不到标准头文件（stdint.h, string 等）

这通常是因为 MSVC 环境未正确初始化。确保：
1. 使用提供的构建脚本（会自动初始化环境）
2. 或在 Visual Studio Developer Command Prompt 中运行

### 构建目录不存在

首次构建需要先运行 CMake 配置命令（见上方"首次构建"部分）。

## 构建优化

- 使用 `--parallel 8` 参数可以并行编译，加快构建速度
- Release 配置会进行优化，生成的文件更小、运行更快
- 增量构建：只编译修改过的文件，大幅提升后续构建速度




