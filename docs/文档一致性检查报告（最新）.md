# 文档一致性检查报告（最新）

> **检查日期**：2026-01-07  
> **检查范围**：架构核心文档  
> **状态**：⚠️ 发现多处冲突，需统一

---

## 🚨 严重冲突（必须修复）

### 1. 线程模型冲突

| 文档 | 线程模型 | 状态 |
|------|---------|------|
| **项目架构图（1页版）.md** | UI主线程 + 下载线程 + 播放器内部线程（3个） | ⚠️ **MVP简化版** |
| **工程规范与避坑指南（定版）.md** | 1个Main Thread + 1个Download Thread + tplayer内部 | ✅ **一致** |
| **MVP版本需求整理（最终版）.md** | 4线程（UI主线程、输入线程、业务线程、播放器线程） | ❌ **冲突** |
| **并发架构总结构（最终版）.md** | 4线程（UI主线程、播放器线程、网络线程、SDK内部线程） | ❌ **冲突** |
| **线程架构基线（最终版）.md** | 复杂模型（UI主线程、Event Loop、Network Worker、Player Worker等） | ❌ **冲突** |

**问题**：
- `项目架构图（1页版）.md` 已更新为MVP简化版（3线程）
- 但其他文档仍描述4线程或更复杂模型
- `MVP版本需求整理（最终版）.md` 仍说"4线程+2队列"

**建议修复**：
- 以 `工程规范与避坑指南（定版）.md` 为准（MVP简化版）
- 更新所有文档统一为：**UI主线程 + 下载线程 + 播放器内部线程**

---

### 2. 队列模型冲突

| 文档 | 队列模型 | 状态 |
|------|---------|------|
| **项目架构图（1页版）.md** | 1个队列（UiEventQueue） | ⚠️ **MVP简化版** |
| **工程规范与避坑指南（定版）.md** | 未明确说明队列数量 | ⚠️ **需补充** |
| **MVP版本需求整理（最终版）.md** | 2个队列（PlayerCmdQueue + UiEventQueue） | ❌ **冲突** |
| **并发架构总结构（最终版）.md** | 2个队列（PlayerCmdQueue + UiEventQueue） | ❌ **冲突** |
| **事件架构规范.md** | 2个队列（PlayerCmdQueue + UiEventQueue） | ❌ **冲突** |

**问题**：
- `项目架构图（1页版）.md` 已更新为1个队列（UiEventQueue）
- 但其他文档仍描述2个队列
- MVP简化架构中，网络请求在主线程同步执行，不需要PlayerCmdQueue

**建议修复**：
- 以 `项目架构图（1页版）.md` 为准（MVP简化版）
- 更新所有文档统一为：**1个队列（UiEventQueue）**
- 移除PlayerCmdQueue相关描述（MVP阶段不需要）

---

### 3. WebSocket功能冲突

| 文档 | WebSocket状态 | 状态 |
|------|-------------|------|
| **开源库选型指南.md** | ❌ 明确不会用 | ✅ **定版** |
| **MVP版本需求整理（最终版）.md** | ✅ 包含WebSocket长连接 | ❌ **冲突** |
| **服务层API设计文档.md** | ✅ 包含WebSocketService | ❌ **冲突** |

**问题**：
- `开源库选型指南.md` 明确说不用WebSocket
- 但需求文档和服务层API文档仍包含WebSocket

**建议修复**：
- 以 `开源库选型指南.md` 为准
- 从 `MVP版本需求整理（最终版）.md` 中移除WebSocket
- 从 `服务层API设计文档.md` 中移除WebSocketService（或标记为非MVP）

---

### 4. 网络请求方式冲突

| 文档 | 网络请求方式 | 状态 |
|------|------------|------|
| **工程规范与避坑指南（定版）.md** | 普通网络请求可同步（在主线程） | ✅ **MVP简化版** |
| **项目架构图（1页版）.md** | 搜索/列表流程是同步网络（主线程） | ✅ **一致** |
| **并发架构总结构（最终版）.md** | 网络线程（std::async） | ❌ **冲突** |
| **线程架构基线（最终版）.md** | Network Worker线程 | ❌ **冲突** |

**问题**：
- MVP简化架构中，网络请求在主线程同步执行
- 但其他文档仍描述独立的网络线程

**建议修复**：
- 以 `工程规范与避坑指南（定版）.md` 为准
- 更新所有文档统一为：**网络请求在主线程同步执行**

---

## ⚠️ 次要冲突（建议修复）

### 5. 架构图描述不一致

- `项目架构图（1页版）.md` 的架构图仍显示"Input Thread"和"Business Thread"
- 但实际MVP简化版应该是：UI主线程直接处理输入，网络请求同步执行

**建议修复**：
- 更新架构图，移除Input Thread和Business Thread
- 明确标注：UI主线程直接处理LVGL事件，网络请求同步执行

---

### 6. 一句话总结冲突

- `项目架构图（1页版）.md` 的"一句话总结（技术版）"仍说"4线程+2队列"
- 但实际应该是"UI主线程 + 下载线程 + 播放器内部线程 + 1个队列"

**建议修复**：
- 更新一句话总结，与MVP简化架构一致

---

## ✅ 已一致的文档

1. **开源库选型指南.md** - 已统一为MVP简化版（无WebSocket）
2. **工程规范与避坑指南（定版）.md** - 已统一为MVP简化版
3. **README.md** - 已更新为MVP简化版

---

## 📋 修复优先级

### P0（必须立即修复）

1. ✅ **MVP版本需求整理（最终版）.md** - 更新线程模型和队列模型
2. ✅ **并发架构总结构（最终版）.md** - 更新为MVP简化版或标记为"参考文档"
3. ✅ **线程架构基线（最终版）.md** - 更新为MVP简化版或标记为"参考文档"
4. ✅ **事件架构规范.md** - 更新队列模型
5. ✅ **服务层API设计文档.md** - 移除或标记WebSocketService为非MVP

### P1（建议修复）

6. **项目架构图（1页版）.md** - 更新架构图和一句话总结
7. **项目架构设计总览.md** - 更新架构描述

---

## 🎯 统一后的MVP架构（定版）

### 线程模型

- **UI主线程**：LVGL渲染、Controller/Service编排、同步网络请求、同步SQLite
- **下载线程**：m3u8/ts下载（串行）
- **播放器内部线程**：tplayer回调（黑盒，不可控）

### 队列模型

- **UiEventQueue**：下载线程/播放器 → UI主线程

### 网络请求

- **同步执行**：在主线程同步调用libcurl（`curl_easy_perform()`）
- **不阻塞UI**：通过快速返回和状态更新避免卡顿

### 功能范围

- **包含**：首页、历史记录、VIP会员中心、搜索、点歌、播放控制、音轨切换、音量控制
- **不包含**：WebSocket长连接、我的收藏、猜你喜欢、语音点歌、唱歌打分

---

## 📝 修复建议

1. **创建"MVP架构定版"文档**，明确统一后的架构
2. **更新所有冲突文档**，统一为MVP简化版
3. **标记旧文档**：将复杂架构文档标记为"参考文档（非MVP）"
4. **更新文档索引**：在文档索引中明确标注哪些是MVP定版，哪些是参考

---

**最后更新**: 2026-01-07  
**状态**: ⚠️ 发现多处冲突，需统一修复

