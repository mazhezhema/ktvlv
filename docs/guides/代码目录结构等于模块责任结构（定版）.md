# ä»£ç ç›®å½•ç»“æ„ = æ¨¡å—è´£ä»»ç»“æ„ï¼ˆå®šç‰ˆï¼‰

> **æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
> **æœ€åæ›´æ–°**ï¼š2025-12-30  
> **çŠ¶æ€**ï¼šâœ… å®šç‰ˆï¼ˆä¸å¯å†äº‰ï¼‰  
> **ç”¨é€”**ï¼šç›®å½•å³è´£ä»»ï¼Œæ¥å£å³åˆåŒ

---

## ğŸ“ å®Œæ•´ç›®å½•ç»“æ„

```text
ktvlv/
â”œâ”€ src/
â”‚  â”œâ”€ main.cpp                    # å¯åŠ¨æµç¨‹ï¼ˆPM Aï¼Œå·¥ç¨‹å¸ˆBä»£å†™ï¼‰
â”‚  â”‚
â”‚  â”œâ”€ events/                      # äº‹ä»¶ç³»ç»Ÿï¼ˆPM Aï¼Œæ¡†æ¶å±‚ï¼‰
â”‚  â”‚  â”œâ”€ event_types.h            # Event ID / Event ç»“æ„å®šä¹‰ï¼ˆPM Aï¼‰
â”‚  â”‚  â”œâ”€ event_queue.h/.cpp       # äº‹ä»¶é˜Ÿåˆ—
â”‚  â”‚  â””â”€ event_dispatcher.h/.cpp  # äº‹ä»¶åˆ†å‘å™¨
â”‚  â”‚
â”‚  â”œâ”€ app/                         # åº”ç”¨å±‚ï¼ˆPM Aï¼‰
â”‚  â”‚  â””â”€ AppController.h/.cpp     # åº”ç”¨æ§åˆ¶å™¨ï¼ˆç¼–æ’ï¼ŒPMå®šæ¨¡æ¿ï¼‰
â”‚  â”‚
â”‚  â”œâ”€ ui/                          # UI å±‚ï¼ˆå·¥ç¨‹å¸ˆAï¼‰
â”‚  â”‚  â”œâ”€ page_manager.h/.cpp      # é¡µé¢ç®¡ç†å™¨
â”‚  â”‚  â”œâ”€ pages/                    # é¡µé¢å®ç°
â”‚  â”‚  â”‚  â”œâ”€ PageHome.h/.cpp
â”‚  â”‚  â”‚  â”œâ”€ PageSearch.h/.cpp
â”‚  â”‚  â”‚  â””â”€ PageCategory.h/.cpp
â”‚  â”‚  â”œâ”€ components/               # UI ç»„ä»¶
â”‚  â”‚  â”‚  â”œâ”€ SongListItem.h/.cpp
â”‚  â”‚  â”‚  â””â”€ SearchBar.h/.cpp
â”‚  â”‚  â””â”€ ui_state.h/.cpp          # UI çŠ¶æ€ç®¡ç†ï¼ˆloading/empty/errorï¼‰
â”‚  â”‚
â”‚  â”œâ”€ features/                    # ä¸šåŠ¡å±‚ï¼ˆå·¥ç¨‹å¸ˆBï¼‰
â”‚  â”‚  â”œâ”€ category/
â”‚  â”‚  â”‚  â”œâ”€ CategoryController.h/.cpp   # Controllerï¼ˆç¼–æ’ï¼‰
â”‚  â”‚  â”‚  â”œâ”€ CategoryService.h/.cpp      # Serviceï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
â”‚  â”‚  â”‚  â””â”€ CategoryModel.h/.cpp        # Modelï¼ˆæ•°æ®æ¨¡å‹ï¼‰
â”‚  â”‚  â”œâ”€ song/
â”‚  â”‚  â”‚  â”œâ”€ SongController.h/.cpp
â”‚  â”‚  â”‚  â”œâ”€ SongService.h/.cpp
â”‚  â”‚  â”‚  â””â”€ SongModel.h/.cpp
â”‚  â”‚  â””â”€ rank/
â”‚  â”‚     â”œâ”€ RankController.h/.cpp
â”‚  â”‚     â”œâ”€ RankService.h/.cpp
â”‚  â”‚     â””â”€ RankModel.h/.cpp
â”‚  â”‚
â”‚  â”œâ”€ services/                    # Service å±‚ï¼ˆå·¥ç¨‹å¸ˆBï¼‰
â”‚  â”‚  â”œâ”€ network_service.h/.cpp   # NetworkServiceï¼ˆlibcurlå°è£…ï¼ŒPM Aæ¥å£ï¼‰
â”‚  â”‚  â”œâ”€ player_service.h/.cpp    # PlayerService
â”‚  â”‚  â”œâ”€ history_service.h/.cpp   # HistoryService
â”‚  â”‚  â””â”€ cache_service.h/.cpp     # CacheService
â”‚  â”‚
â”‚  â”œâ”€ models/                      # æ•°æ®æ¨¡å‹ï¼ˆå·¥ç¨‹å¸ˆBï¼‰
â”‚  â”‚  â”œâ”€ Song.h/.cpp
â”‚  â”‚  â”œâ”€ Category.h/.cpp
â”‚  â”‚  â””â”€ Rank.h/.cpp
â”‚  â”‚
â”‚  â”œâ”€ adapter/                     # Adapter å±‚ï¼ˆé«˜é£é™©ï¼ŒPM Aæ¥å£ï¼Œå·¥ç¨‹å¸ˆBå®ç°ï¼‰
â”‚  â”‚  â”œâ”€ network_adapter.h/.cpp   # NetworkAdapterï¼ˆPM Aæ¥å£ï¼‰
â”‚  â”‚  â”œâ”€ player_adapter.h/.cpp    # PlayerAdapterï¼ˆPM Aæ¥å£ï¼‰
â”‚  â”‚  â””â”€ storage_adapter.h/.cpp   # StorageAdapterï¼ˆPM Aæ¥å£ï¼‰
â”‚  â”‚
â”‚  â””â”€ platform/                    # å¹³å°å±‚ï¼ˆç³»ç»Ÿä¾èµ–ï¼‰
â”‚     â””â”€ f133_linux/
â”‚        â”œâ”€ display_fbdev.c
â”‚        â”œâ”€ input_evdev.c
â”‚        â””â”€ audio_alsa.c
â”‚
â”œâ”€ docs/                           # æ–‡æ¡£ç›®å½•
â””â”€ CMakeLists.txt                  # æ„å»ºé…ç½®
```

---

## ğŸ“‹ ç›®å½•è´£ä»»è¯´æ˜

### 1ï¸âƒ£ `src/events/` - äº‹ä»¶ç³»ç»Ÿï¼ˆPM Aï¼Œæ¡†æ¶å±‚ï¼‰

**è´£ä»»äºº**ï¼šPMï¼ˆA - å†³ç­–ï¼‰ï¼Œå·¥ç¨‹å¸ˆï¼ˆI - çŸ¥æƒ…ï¼‰

**èŒè´£**ï¼š
- `event_types.h`ï¼šEvent ID / Event ç»“æ„å®šä¹‰ï¼ˆ**PM A**ï¼‰
- `event_queue.h/.cpp`ï¼šäº‹ä»¶é˜Ÿåˆ—å®ç°ï¼ˆæ¡†æ¶å±‚ï¼‰
- `event_dispatcher.h/.cpp`ï¼šäº‹ä»¶åˆ†å‘å™¨å®ç°ï¼ˆæ¡†æ¶å±‚ï¼‰

**ç¦æ­¢é¡¹**ï¼š
- âŒ å·¥ç¨‹å¸ˆä¸èƒ½ä¿®æ”¹ `event_types.h`
- âŒ å·¥ç¨‹å¸ˆä¸èƒ½ä¿®æ”¹ Event ç»“æ„

---

### 2ï¸âƒ£ `src/app/` - åº”ç”¨å±‚ï¼ˆPM Aï¼‰

**è´£ä»»äºº**ï¼šPMï¼ˆA - å†³ç­–ï¼‰ï¼Œå·¥ç¨‹å¸ˆBï¼ˆR - å®ç°ï¼‰

**èŒè´£**ï¼š
- `AppController.h/.cpp`ï¼šåº”ç”¨æ§åˆ¶å™¨ï¼Œç¼–æ’é€»è¾‘ï¼ˆPMå®šæ¨¡æ¿ï¼‰

---

### 3ï¸âƒ£ `src/ui/` - UI å±‚ï¼ˆå·¥ç¨‹å¸ˆAï¼‰

**è´£ä»»äºº**ï¼šå·¥ç¨‹å¸ˆAï¼ˆR - å®ç°ï¼‰ï¼ŒPMï¼ˆI - çŸ¥æƒ…ï¼ŒUIçŠ¶æ€ç­–ç•¥ Aï¼‰

**èŒè´£**ï¼š
- `pages/`ï¼šé¡µé¢å®ç°ï¼ˆLVGLï¼‰
- `components/`ï¼šUI ç»„ä»¶
- `ui_state.h/.cpp`ï¼šUI çŠ¶æ€ç®¡ç†ï¼ˆloading/empty/errorï¼ŒPM Aï¼‰

**ç¦æ­¢é¡¹**ï¼š
- âŒ ä¸èƒ½ include `services/*`
- âŒ ä¸èƒ½ include `features/*/Service`
- âŒ ä¸èƒ½ç›´æ¥è°ƒç”¨ Service

**å…è®¸é¡¹**ï¼š
- âœ… å¯ä»¥ include `events/event_queue.h`ï¼ˆå‘é€ Eventï¼‰
- âœ… å¯ä»¥ include `features/*/Controller.h`ï¼ˆè°ƒç”¨ Controllerï¼‰

---

### 4ï¸âƒ£ `src/features/` - ä¸šåŠ¡å±‚ï¼ˆå·¥ç¨‹å¸ˆBï¼‰

**è´£ä»»äºº**ï¼šå·¥ç¨‹å¸ˆBï¼ˆR - å®ç°ï¼‰ï¼ŒPMï¼ˆI - çŸ¥æƒ…ï¼‰

**èŒè´£**ï¼š
- `{Module}Controller.h/.cpp`ï¼šControllerï¼ˆç¼–æ’é€»è¾‘ï¼‰
- `{Module}Service.h/.cpp`ï¼šServiceï¼ˆä¸šåŠ¡é€»è¾‘ï¼‰
- `{Module}Model.h/.cpp`ï¼šModelï¼ˆæ•°æ®æ¨¡å‹ï¼‰

**ç¦æ­¢é¡¹**ï¼š
- âŒ Controller ä¸èƒ½è§£æ JSON
- âŒ Controller ä¸èƒ½åšä¸šåŠ¡é€»è¾‘
- âŒ Service ä¸èƒ½æ“ä½œ UI

**å…è®¸é¡¹**ï¼š
- âœ… Controller å¯ä»¥è°ƒç”¨ Service
- âœ… Service å¯ä»¥è°ƒç”¨ NetworkService
- âœ… Service å¯ä»¥å‘é€ Event

---

### 5ï¸âƒ£ `src/services/` - Service å±‚ï¼ˆå·¥ç¨‹å¸ˆBï¼‰

**è´£ä»»äºº**ï¼šå·¥ç¨‹å¸ˆBï¼ˆR - å®ç°ï¼‰ï¼ŒPMï¼ˆNetworkServiceæ¥å£ Aï¼‰

**èŒè´£**ï¼š
- `network_service.h/.cpp`ï¼šNetworkServiceï¼ˆlibcurlå°è£…ï¼Œ**PM Aæ¥å£**ï¼‰
- `player_service.h/.cpp`ï¼šPlayerService
- `history_service.h/.cpp`ï¼šHistoryService
- `cache_service.h/.cpp`ï¼šCacheService

**ç¦æ­¢é¡¹**ï¼š
- âŒ ä¸èƒ½ include `ui/*`
- âŒ ä¸èƒ½æ“ä½œ LVGL æ§ä»¶
- âŒ NetworkService æ¥å£ä¸èƒ½ä¿®æ”¹ï¼ˆPM Aï¼‰

---

### 6ï¸âƒ£ `src/models/` - æ•°æ®æ¨¡å‹ï¼ˆå·¥ç¨‹å¸ˆBï¼‰

**è´£ä»»äºº**ï¼šå·¥ç¨‹å¸ˆBï¼ˆR - å®ç°ï¼‰ï¼ŒPMï¼ˆI - çŸ¥æƒ…ï¼‰

**èŒè´£**ï¼š
- æ•°æ®æ¨¡å‹å®šä¹‰ï¼ˆSongã€Categoryã€Rankç­‰ï¼‰
- JSON åºåˆ—åŒ–/ååºåˆ—åŒ–

---

### 7ï¸âƒ£ `src/adapter/` - Adapter å±‚ï¼ˆé«˜é£é™©ï¼ŒPM Aæ¥å£ï¼‰

**è´£ä»»äºº**ï¼šPMï¼ˆA - æ¥å£å®šä¹‰ï¼‰ï¼Œå·¥ç¨‹å¸ˆBï¼ˆR - å®ç°ï¼ŒæŒ‰æ¥å£ï¼‰

**èŒè´£**ï¼š
- `network_adapter.h/.cpp`ï¼šNetworkAdapterï¼ˆ**PM Aæ¥å£**ï¼Œå·¥ç¨‹å¸ˆBå®ç°ï¼‰
- `player_adapter.h/.cpp`ï¼šPlayerAdapterï¼ˆ**PM Aæ¥å£**ï¼Œå·¥ç¨‹å¸ˆBå®ç°ï¼‰
- `storage_adapter.h/.cpp`ï¼šStorageAdapterï¼ˆ**PM Aæ¥å£**ï¼Œå·¥ç¨‹å¸ˆBå®ç°ï¼‰

**ç¦æ­¢é¡¹**ï¼š
- âŒ å·¥ç¨‹å¸ˆä¸èƒ½ä¿®æ”¹ Adapter æ¥å£ï¼ˆ`.h` æ–‡ä»¶ï¼‰
- âŒ æ¥å£å˜æ›´å¿…é¡» PM review

---

### 8ï¸âƒ£ `src/platform/` - å¹³å°å±‚ï¼ˆç³»ç»Ÿä¾èµ–ï¼‰

**è´£ä»»äºº**ï¼šæ¡†æ¶å±‚ç»´æŠ¤

**èŒè´£**ï¼š
- å¹³å°ç‰¹å®šå®ç°ï¼ˆF133 Linuxï¼‰
- é©±åŠ¨æŠ½è±¡

---

## ğŸ” æ£€æŸ¥æ³•ï¼ˆæ¯æ—¥å¿…æŸ¥ï¼‰

### ä¾èµ–æ£€æŸ¥

```bash
# UI å±‚æ£€æŸ¥ï¼šä¸èƒ½ include service
grep -r "#include.*service" src/ui/
# åº”è¯¥è¿”å›ï¼šæ— ç»“æœæˆ–åªæœ‰ events/event_queue.h

# Service å±‚æ£€æŸ¥ï¼šä¸èƒ½ include ui
grep -r "#include.*ui" src/services/ src/features/
# åº”è¯¥è¿”å›ï¼šæ— ç»“æœ

# Adapter æ¥å£æ£€æŸ¥ï¼šæ¥å£æ˜¯å¦è¢«ä¿®æ”¹
git diff src/adapter/*.h
# å¦‚æœæœ‰å˜æ›´ï¼Œå¿…é¡» PM review
```

---

### æ–‡ä»¶ä½ç½®æ£€æŸ¥

| æ–‡ä»¶ç±»å‹ | åº”è¯¥åœ¨å“ªé‡Œ | ç¦æ­¢åœ¨å“ªé‡Œ |
|---------|----------|----------|
| **UI é¡µé¢** | `src/ui/pages/` | ä¸åœ¨ `src/services/`ã€`src/features/` |
| **Service** | `src/features/*/Service.h` æˆ– `src/services/` | ä¸åœ¨ `src/ui/` |
| **Controller** | `src/features/*/Controller.h` | ä¸åœ¨ `src/ui/`ã€`src/services/` |
| **Adapter** | `src/adapter/` | ä¸åœ¨å…¶ä»–ç›®å½• |
| **Event å®šä¹‰** | `src/events/event_types.h` | ä¸åœ¨å…¶ä»–ç›®å½• |

---

### æ¥å£æ£€æŸ¥

| æ¥å£ç±»å‹ | è°å®šä¹‰ | è°å®ç° | è°review |
|---------|--------|--------|----------|
| **Event ç»“æ„** | PMï¼ˆAï¼‰ | æ¡†æ¶å±‚ | PM |
| **NetworkService æ¥å£** | PMï¼ˆAï¼‰ | å·¥ç¨‹å¸ˆB | PM |
| **Adapter æ¥å£** | PMï¼ˆAï¼‰ | å·¥ç¨‹å¸ˆB | PM |
| **Controller æ¥å£** | PMï¼ˆAï¼Œæ¨¡æ¿ï¼‰ | å·¥ç¨‹å¸ˆB | PM |
| **UI çŠ¶æ€æ¥å£** | PMï¼ˆAï¼‰ | å·¥ç¨‹å¸ˆA | PM |

---

## ğŸ“Š ç›®å½•ä¸è´£ä»»æ˜ å°„è¡¨

| ç›®å½• | PM | å·¥ç¨‹å¸ˆA | å·¥ç¨‹å¸ˆB | è¯´æ˜ |
|------|-----|---------|---------|------|
| `events/event_types.h` | **A** | I | I | Event å®šä¹‰ |
| `ui/` | Iï¼ˆUIçŠ¶æ€Aï¼‰ | **R** | I | UI å±‚ |
| `features/` | I | I | **R** | ä¸šåŠ¡å±‚ |
| `services/network_service.h` | **A** | I | **R** | NetworkService æ¥å£ |
| `adapter/*.h` | **A** | I | Rï¼ˆæŒ‰æ¥å£ï¼‰ | Adapter æ¥å£ |
| `adapter/*.cpp` | Cï¼ˆreviewï¼‰ | I | **R** | Adapter å®ç° |
| `app/` | **A** | I | R | åº”ç”¨å±‚ |
| `main.cpp` | **A** | I | R | å¯åŠ¨æµç¨‹ |

---

## ğŸš« ç¦æ­¢çš„è·¨ç›®å½•ä¾èµ–

### âŒ UI å±‚ç¦æ­¢

```cpp
// âŒ é”™è¯¯ï¼šUI å±‚ include Service
#include "services/network_service.h"  // ç¦æ­¢ï¼
#include "features/category/CategoryService.h"  // ç¦æ­¢ï¼

// âœ… æ­£ç¡®ï¼šUI å±‚åª include Event å’Œ Controller
#include "events/event_queue.h"
#include "features/category/CategoryController.h"
```

---

### âŒ Service å±‚ç¦æ­¢

```cpp
// âŒ é”™è¯¯ï¼šService å±‚ include UI
#include "ui/pages/PageCategory.h"  // ç¦æ­¢ï¼
#include "ui/ui_state.h"  // ç¦æ­¢ï¼

// âœ… æ­£ç¡®ï¼šService å±‚åª include Service å’Œ Event
#include "services/network_service.h"
#include "events/event_queue.h"
```

---

### âŒ Controller ç¦æ­¢

```cpp
// âŒ é”™è¯¯ï¼šController è§£æ JSON
#include "cJSON.h"
void CategoryController::handleData(const char* json) {
    cJSON* root = cJSON_Parse(json);  // ç¦æ­¢ï¼åº”è¯¥åœ¨ Service å±‚
}

// âœ… æ­£ç¡®ï¼šController åªç¼–æ’
void CategoryController::onUiCategoryClicked(int categoryId) {
    CategoryService::instance().load(categoryId);
}
```

---

## âœ… å…è®¸çš„ä¾èµ–æ–¹å‘

```
UIå±‚ (src/ui/)
  â†“ include
Controller (src/features/*/Controller.h)
  â†“ include
Service (src/features/*/Service.h)
  â†“ include
NetworkService (src/services/network_service.h)
  â†“ include
Adapter (src/adapter/network_adapter.h)
  â†“ include
SDK (libcurlã€sqliteã€tplayer)
```

**ä¾èµ–æ–¹å‘**ï¼šUI â†’ Controller â†’ Service â†’ NetworkService â†’ Adapter â†’ SDK

**ç¦æ­¢åå‘ä¾èµ–**ï¼šSDK â†’ Adapter â†’ Service â†’ Controller â†’ UI

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ¨¡å—è´£ä»»è¡¨ï¼ˆRACIæœ€ç»ˆç‰ˆï¼‰.md](./æ¨¡å—è´£ä»»è¡¨ï¼ˆRACIæœ€ç»ˆç‰ˆï¼‰.md) â­â­â­ **å¿…è¯»**
- [Tina_KTVé¡¹ç›®10æ¡é“å¾‹ï¼ˆè´´å¢™ç‰ˆï¼‰.md](./Tina_KTVé¡¹ç›®10æ¡é“å¾‹ï¼ˆè´´å¢™ç‰ˆï¼‰.md) â­â­â­ **å¿…è¯»**
- [é¡¹ç›®è„šæ‰‹æ¶ç»“æ„.md](../é¡¹ç›®è„šæ‰‹æ¶ç»“æ„.md) â­â­ **å‚è€ƒ**

---

**æœ€åæ›´æ–°**: 2025-12-30  
**çŠ¶æ€**: âœ… å®šç‰ˆï¼ˆç›®å½•å³è´£ä»»ï¼‰  
**ç»´æŠ¤è€…**: Tech Product Owner

