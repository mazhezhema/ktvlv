# 工程师入场须知（第一天必读）

> **文档版本**：v1.0  
> **最后更新**：2025-12-30  
> **状态**：✅ 定版（第一天必读）  
> **用途**：新工程师第一天必须阅读并理解

---

## 📋 你来做什么

### 工程师 A：UI / 页面 / 状态

**你的职责**：
- ✅ LVGL 页面实现
- ✅ 控件布局
- ✅ 页面生命周期（show/hide）
- ✅ UI 状态管理（loading/empty/error）
- ✅ UI 事件产生（用户交互）

**你的工作区域**：
- `src/ui/` - UI 层代码
- `src/ui/pages/` - 页面实现
- `src/ui/components/` - UI 组件

---

### 工程师 B：Service / 网络 / 数据

**你的职责**：
- ✅ Service 实现（Category、Song、Rank Service）
- ✅ NetworkService 实现（libcurl 封装）
- ✅ JSON 解析
- ✅ Repo 实现（数据仓库）
- ✅ SQLite / 本地存储

**你的工作区域**：
- `src/services/` - Service 层代码
- `src/events/` - 事件系统（按 PM 定义的接口使用）
- `src/models/` - 数据模型

---

## 🚫 你不能做什么

### 禁止项（违者返工）

1. ❌ **不引线程**：不能自行创建线程（`std::thread`、`pthread`）
2. ❌ **不越层**：UI 不能调用 Service，Service 不能操作 UI
3. ❌ **不改架构**：不能修改架构决策（Event 结构、线程模型、Singleton 策略）
4. ❌ **不绕接口**：必须通过接口协作，不能绕过 header 文件

---

## 💡 你只需要记住 4 句话

### 1️⃣ UI 只发 Event

**规则**：
- UI 层不能直接调用 Service
- UI 只能发送 Event 到 EventQueue
- UI 不做业务决策

**示例**：
```cpp
// ✅ 正确：UI 发送 Event
void onCategoryClicked(int categoryId) {
    AppEvent ev;
    ev.type = EventType::EVENT_CATEGORY_CLICK;
    ev.arg1 = categoryId;
    EventQueue::instance().enqueue(ev);
}

// ❌ 错误：UI 直接调用 Service
void onCategoryClicked(int categoryId) {
    CategoryService::instance().load(categoryId);  // 禁止！
}
```

---

### 2️⃣ Service 只产数据

**规则**：
- Service 不能操作 LVGL 控件
- Service 不能修改 UI 状态
- Service 只负责业务逻辑和数据

**示例**：
```cpp
// ✅ 正确：Service 只产数据
void CategoryService::load(int categoryId) {
    // 网络请求
    // 数据解析
    // 发送 Event（通知结果）
    AppEvent ev;
    ev.type = EventType::EVENT_CATEGORY_DATA_READY;
    EventQueue::instance().enqueue(ev);
}

// ❌ 错误：Service 操作 UI
void CategoryService::load(int categoryId) {
    lv_label_set_text(label_, "Loading");  // 禁止！
}
```

---

### 3️⃣ Controller 只编排

**规则**：
- Controller 只做三件事：接 Event → 调 Service → 更新 UI State
- Controller 不做业务逻辑
- Controller 不解析 JSON

**示例**：
```cpp
// ✅ 正确：Controller 只编排
void CategoryController::onUiCategoryClicked(int categoryId) {
    // 1. 更新 UI 状态
    CategoryPage::instance().setLoading(true);
    
    // 2. 调用 Service
    CategoryService::instance().load(categoryId);
}

void CategoryController::onSvcCategoryDataReady(int categoryId, void* data) {
    // 1. 更新 UI 状态
    CategoryPage::instance().setLoading(false);
    
    // 2. 刷新 UI
    CategoryPage::instance().updateCategoryList(data);
}

// ❌ 错误：Controller 做业务逻辑
void CategoryController::onUiCategoryClicked(int categoryId) {
    // 禁止！业务逻辑应该在 Service 层
    CURL* curl = curl_easy_init();  // 禁止！
    // ... 网络请求代码
}
```

---

### 4️⃣ Adapter 只你能碰（按接口）

**规则**：
- Adapter 接口由 PM 定义
- 工程师只能实现，不能修改接口
- Adapter 实现必须经过 PM review

**示例**：
```cpp
// ✅ 正确：按 PM 定义的接口实现
// network_adapter.h（PM 定义）
class NetworkAdapter {
public:
    static NetworkAdapter& instance();
    void init();
    void fetchCategory(int categoryId);
};

// network_adapter.cpp（工程师实现）
void NetworkAdapter::fetchCategory(int categoryId) {
    // 实现 libcurl 逻辑
}

// ❌ 错误：修改接口
class NetworkAdapter {
public:
    void fetchCategory(int categoryId, int timeout);  // 禁止！未经 PM 批准
};
```

---

## 🔍 任何疑问的处理顺序

遇到任何技术问题，按以下顺序思考：

### 1️⃣ 先问：能不能同步？

**问题**：
- 这个功能能不能用同步调用实现？
- 用户能接受等待 1-2 秒吗？

**答案**：
- ✅ 如果能 → **用同步实现，不要并发**
- ❌ 如果不能 → 继续下一问

---

### 2️⃣ 再问：能不能用 loading？

**问题**：
- 网络请求时，能不能显示 loading？
- 能不能用 loading 顶住，不用架构升级？

**答案**：
- ✅ 如果能 → **用 loading，不要架构升级**
- ❌ 如果不能 → 继续下一问

---

### 3️⃣ 再问：是不是现在非做不可？

**问题**：
- 这个功能是 MVP 核心功能吗？
- 如果延后 2 周，会影响 MVP 交付吗？

**答案**：
- ✅ 如果是 → **找 PM 讨论**
- ❌ 如果不是 → **延后或放弃**

---

## 📚 第一天必读文档

### 必须阅读（按顺序）

1. **[Tina_KTV项目10条铁律（贴墙版）.md](./Tina_KTV项目10条铁律（贴墙版）.md)** ⭐⭐⭐ **必读**
   - 10 条铁律，违者返工

2. **[模块责任表（RACI最终版）.md](./模块责任表（RACI最终版）.md)** ⭐⭐⭐ **必读**
   - 明确你的职责范围

3. **[应用层命名规范（架构约束版）.md](./应用层命名规范（架构约束版）.md)** ⭐⭐⭐ **必读**
   - 命名规范（onUiXxx、onSvcXxx、handleXxx）

4. **[事件模型MVP实现指南（可落地版）.md](./事件模型MVP实现指南（可落地版）.md)** ⭐⭐⭐ **必读**
   - 事件系统如何使用

5. **[NetworkService与libcurl实现指南（MVP可落地版）.md](./NetworkService与libcurl实现指南（MVP可落地版）.md)** ⭐⭐⭐ **工程师B必读**
   - NetworkService 如何使用

### 参考阅读

6. **[Cursor开发指南.md](../Cursor开发指南.md)** ⭐⭐ **参考**
   - 代码生成模板

7. **[代码目录结构等于模块责任结构（定版）.md](./代码目录结构等于模块责任结构（定版）.md)** ⭐⭐ **参考**
   - 代码组织结构与责任边界

---

## ⚠️ 紧急情况处理

### 遇到架构相关问题时

1. **不要自行决策**：任何架构相关问题，必须找 PM
2. **不要"先写了再说"**：任何不确定的问题，先问 PM
3. **不要绕过接口**：必须通过 header 文件协作

### 代码 Review 时

1. **直接指出问题**：违反铁律，直接指出
2. **不讨论、不解释**：违反铁律 = 返工，不需要讨论
3. **记录问题**：记录违反的铁律，作为培训素材

---

## ✅ 第一天检查清单

第一天结束时，确保你：

- [ ] 已阅读 10 条铁律
- [ ] 已理解你的职责范围（RACI 表）
- [ ] 已理解 4 句话（UI只发Event、Service只产数据、Controller只编排、Adapter按接口）
- [ ] 已理解疑问处理顺序（能不能同步→能不能用loading→是不是现在非做不可）
- [ ] 已熟悉你的工作目录（`src/ui/` 或 `src/services/`）
- [ ] 已理解命名规范（onUiXxx、onSvcXxx、handleXxx）
- [ ] 已理解事件系统基本用法（EventQueue、EventDispatcher）

---

## 📝 第一天任务建议

### 工程师 A（UI）

1. 阅读 10 条铁律
2. 理解 UI 层职责
3. 查看 `src/ui/` 目录结构
4. 理解页面生命周期（show/hide）
5. 理解 UI 事件如何发送

### 工程师 B（Service）

1. 阅读 10 条铁律
2. 理解 Service 层职责
3. 查看 `src/services/` 目录结构
4. 理解 NetworkService 如何使用
5. 理解 Service 如何发送 Event

---

## 💬 如果有任何疑问

**问 PM，不要自行决策。**

记住：**违反铁律 = 返工，不需要讨论。**

---

**最后更新**: 2025-12-30  
**状态**: ✅ 定版（第一天必读）  
**维护者**: Tech Product Owner

