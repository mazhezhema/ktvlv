# 开源库清单（新架构 · 定版 · 去水分）

> **文档版本**：v2.0  
> **最后更新**：2026-01-07  
> **状态**：✅ 定版（以此为准）  
> **目标平台**：F133 / Tina Linux（主要），Windows（开发阶段参考）  
> **用途**：只列“现在真的会用、必须用、用得住”的库；不预埋未来债  
> **相关文档**：  
>
> - [项目架构图（1页版）.md](../项目架构图（1页版）.md)  
> - [线程架构基线（最终版）.md](../线程架构基线（最终版）.md)  
> - [并发架构总结构（最终版）.md](../architecture/并发架构总结构（最终版）.md)  
> - [HTTP_REST_API客户端设计.md](../design/HTTP_REST_API客户端设计.md)  
> - [历史记录SQLite实现设计.md](../design/历史记录SQLite实现设计.md)  
> - [M3u8下载与本地存储设计.md](../design/M3u8下载与本地存储设计.md)

---

## 🎯 一句话版（给领导/评审）

> **UI 用 LVGL，网络用 libcurl，JSON 用 cJSON，数据库用 SQLite，播放用 tplayer，下载线程自己封装，日志用 syslog。**  
> **没有多余库，没有框架套娃。**

---

## ✅ 必选库（按层/职责）

### 1️⃣ UI 层（LVGL 体系）

- **LVGL**
  - **用途**：页面/控件/事件（UI唯一外部依赖）
  - **线程**：UI 主线程（LVGL 单 Owner）
  - **硬规则**
    - UI 回调 **必须立刻返回**
    - 禁止在 LVGL 回调里做 **网络/IO/JSON/数据库**

---

### 2️⃣ 基础（C/C++ 标准库）

- **libc / libstdc++**
  - **用途**：`std::string`、`std::vector`、`std::queue`、`std::mutex`、`condition_variable` 等
  - **原则**：只用基础容器；不引入复杂并发框架/线程池

---

### 3️⃣ 网络（普通同步请求）

- **libcurl**
  - **用途**：HTTP GET/POST（拉取 REST API）
  - **使用方式**：**同步阻塞**（`curl_easy_perform()`），由 Service/Worker 线程调用
  - **注意定位**
    - libcurl ≠ 线程
    - libcurl ≠ 下载管理
    - libcurl = 纯网络工具

---

### 4️⃣ JSON 解析

- **cJSON**
  - **用途**：解析 REST API 返回
  - **规则**
    - 解析完 **立即释放**（不跨函数保存 `cJSON*`）
    - 禁止在 UI 回调里 parse

---

### 5️⃣ 本地数据库

- **SQLite（系统自带）**
  - **用途**：历史记录/缓存索引/本地持久化
  - **使用方式**：**单连接 + 串行访问**
  - **为什么不加 ORM**：复杂度不值、嵌入式不友好

---

### 6️⃣ 播放器（系统级组件）

- **tplayer（Allwinner / Tina）**
  - **用途**：音视频播放（系统能力，内部多线程黑盒）
  - **规则**
    - 必须走 Adapter/Service 封装
    - 回调只做：**转 Event**，禁止直接操作 UI

---

### 7️⃣ 后台下载（m3u8）

- **pthread（或 `std::thread`）**
  - **用途**：后台下载 m3u8/ts（配合 libcurl + 文件 IO）
  - **硬规则**
    - 全项目只允许 **一个“下载线程”**（其余并发靠队列/状态机）
    - 禁止线程池、禁止 detach（可停止、可回收）

---

### 8️⃣ 日志

- **syslog（系统自带）**
  - **用途**：运行日志、错误排查、运维友好
  - **规则**：ERROR/WARN 禁止高频循环刷屏（详见工程规范）

---

## 📦 完整依赖清单（可直接贴到对外文档）

```text
UI
- lvgl

基础
- libc / libstdc++

网络
- libcurl

数据
- cJSON
- SQLite

播放
- tplayer (cedarx)

后台任务
- pthread / std::thread

日志
- syslog
```

---

## ❌ 明确不会用（写进“禁止事项”）

- ❌ libevent / libuv
- ❌ boost
- ❌ asio
- ❌ protobuf / grpc
- ❌ 多线程线程池
- ❌ 第三方下载 SDK
- ❌ “为未来准备”的网络/序列化框架套娃

> 一句话原因：**当前阶段，用了只会增加不可控复杂度。**

---

## 🔒 变更规则（必须遵守）

- **新增/替换任何库**：必须 PM 批准，并更新本文件（否则一律视为“越权变更”返工）。
