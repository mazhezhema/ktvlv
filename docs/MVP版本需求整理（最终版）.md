# MVP版本需求整理（最终版）

> **文档版本**：v1.0  
> **最后更新**：2025-12-30  
> **状态**：✅ 核心文档  
> **说明**：MVP版本需求的精简整理版，便于快速查阅

---

## 📋 功能范围（一句话总结）

**包含**：首页、历史记录、VIP会员中心、搜索、点歌、播放控制、音轨切换、音量控制、历史记录（最多50首）、VIP会员功能、微信扫码点歌

**不包含**：我的收藏、猜你喜欢、语音点歌、唱歌打分

---

## ✅ 包含的功能（MVP版本）

### 1. 顶部菜单栏（3个Tab）

- ✅ **首页** - 主界面（歌曲浏览、分类、排行榜）
- ✅ **历史记录** - 显示最近播放的50首歌曲（FIFO队列）
- ✅ **VIP会员中心** - 会员功能（查看会员信息、扫码激活等）

### 2. 核心功能

- ✅ **歌曲浏览** - 列表、分类、排行榜
- ✅ **搜索功能** - 歌名、歌手（文本输入）
- ✅ **点歌功能** - 添加到播放列表
- ✅ **播放控制** - 播放、暂停、切歌、重唱
- ✅ **音轨切换** - 原唱/伴奏切换（使用 `TPlayerSwitchAudio`）
- ✅ **音量控制** - 使用 `TPlayerSetVolume`
- ✅ **播放进度** - 显示播放进度
- ✅ **历史记录** - 自动记录最近播放的50首歌曲（FIFO队列，持久化存储）
- ✅ **VIP会员功能** - 会员状态显示、VIP歌曲标识、会员权益展示
- ✅ **微信扫码点歌** - 扫码功能（通过微信扫码进行点歌或激活）
<!-- 非MVP：WebSocket长连接（后续评估） -->

---

## ❌ 不包含的功能（MVP版本暂不做）

### 1. 菜单功能

- ❌ **猜你喜欢** - 推荐算法（未来功能）
- ❌ **我的收藏** - 收藏功能（未来功能）

### 2. 交互功能

- ❌ **语音点歌** - 语音输入搜索（未来功能，v2.0+）
- ❌ **唱歌打分** - 录音评分功能（未来功能，v2.0+）

### 3. 其他功能

- ❌ **系统音效** - UI提示音（不需要，所有播放由TPlayer处理）
- ❌ **录音功能** - ALSA录音（不需要，保持stub实现）

---

## 🏗️ 技术栈

### 平台信息

| 项目 | 说明 |
|------|------|
| **硬件平台** | 全志 F133（ARM Cortex-A7） |
| **操作系统** | Tina Linux（基于 OpenWrt/Buildroot） |
| **编程语言** | C++17 |
| **构建系统** | CMake + 交叉编译工具链 |

### 核心框架

| 框架 | 版本 | 用途 | 来源 |
|------|------|------|------|
| **LVGL** | 8.3.11 | UI框架 | FetchContent |
| **TPlayer** | SDK版本 | 媒体播放器 | F133 SDK（全志官方） |

### 必需库（5个必需 + 2个推荐/可选）

| # | 库名 | 版本 | 用途 | 集成方式 | 状态 |
|---|------|------|------|----------|------|
| 1 | **LVGL** | 8.3.11 | UI框架 | FetchContent | ✅ 必需 |
| 2 | **libcurl** | 最新 | HTTP客户端 | 系统包管理器或交叉编译 | ✅ 必需 |
| 3 | **cJSON** | 最新 | JSON解析 | FetchContent | ✅ 必需 |
| 4 | **std::queue + std::mutex** | C++17标准库 | 消息队列 | 标准库 | ✅ 必需 |
<!-- 非MVP：libwebsockets（后续评估） -->
| 6 | **syslog** | 系统自带 | 日志系统（F133平台） | 系统自带 | ✅ 必需（F133） |
| 8 | **inih** | 最新 | 配置解析 | FetchContent | ✅ 可选 |

> **技术决策**：项目统一使用 `std::queue + std::mutex + condition_variable`（标准库），**不使用 moodycamel::ConcurrentQueue**。详见 [消息队列选型技术决策.md](./guides/消息队列选型技术决策.md)

### 平台特定库

| 库名 | 用途 | 来源 | 状态 |
|------|------|------|------|
| **TPlayer** | m3u8流媒体播放，硬件解码 | F133 SDK（全志官方） | ✅ 必需 |

### 不需要的库（MVP版本）

| 库名 | 原因 |
|------|------|
| **SDL2** | F133 使用 framebuffer + evdev，不需要 SDL2 |
| **ALSA** | 所有播放由 TPlayer 处理，不需要系统音效和录音 |
| **std::queue + std::mutex** | ✅ 已采用（标准库），不使用 moodycamel |

---

## 🧵 线程架构（MVP简化）

### 线程模型

| 线程 | 职责 | 交互方式 |
|------|------|---------|
| **UI主线程** | LVGL渲染、控件逻辑、Controller/Service编排 | 消费 UiEventQueue |
| **下载线程** | m3u8/ts 下载（串行） | 生产 → UiEventQueue |
| **播放器内部线程** | 播放状态回调（tplayer 黑盒） | 生产 → UiEventQueue |

### 消息队列

| 队列 | 流向 | 实现 |
|------|------|------|
| **UiEventQueue** | 下载线程/播放器 → UI | std::queue + std::mutex |

> **详细说明**：详见 [线程架构基线（最终版）.md](./线程架构基线（最终版）.md) 和 [消息队列实现与最佳实践.md](./消息队列实现与最佳实践.md)

---

## 📊 功能优先级

### Phase 1（核心功能）- 已完成

1. ✅ 顶部菜单栏（首页/历史记录/VIP会员中心）
2. ✅ 首页歌曲列表和搜索
3. ✅ 播放控制（播放、暂停、切歌、重唱）
4. ✅ 音轨切换（原唱/伴奏）
5. ✅ 历史记录基本功能

### Phase 2（完善功能）- 进行中

1. ✅ 历史记录持久化（保存到文件）
2. ✅ 历史记录点击播放
3. ✅ 历史记录去重和排序
4. ⚠️ 播放列表管理（已点歌曲队列）
5. ⚠️ VIP会员功能完善
6. ⚠️ 微信扫码点歌完善

### Phase 3（优化）- 未来

1. ⚠️ 性能优化
2. ⚠️ 内存优化
3. ⚠️ 稳定性测试
4. ⚠️ 弱网环境测试

### Phase 4（未来功能）- v2.0+

1. ⚠️ 语音点歌
2. ⚠️ 唱歌打分
3. ⚠️ 我的收藏
4. ⚠️ 猜你喜欢

---

## 🎯 验收标准

### 功能验收

- ✅ 首页可以正常浏览歌曲列表、分类、排行榜
- ✅ 搜索功能可以按歌名、歌手搜索
- ✅ 点歌功能可以添加到播放列表
- ✅ 播放控制（播放、暂停、切歌、重唱）正常工作
- ✅ 音轨切换（原唱/伴奏）正常工作
- ✅ 音量控制正常工作
- ✅ 历史记录自动记录最近播放的50首歌曲
- ✅ 历史记录可以点击重新播放
- ✅ 历史记录持久化存储，应用重启后自动加载
- ✅ VIP会员功能正常工作
- ✅ 微信扫码点歌正常工作
- ✅ WebSocket长连接正常工作

### 性能验收

- ✅ 播放流畅，无卡顿
- ✅ UI 响应及时，无延迟
- ✅ 内存占用合理（预分配内存）
- ✅ 启动时间 < 3秒

### 稳定性验收

- ✅ 长时间运行无崩溃
- ✅ 弱网环境下播放稳定
- ✅ 异常情况处理正确（网络断开、播放失败等）

---

## 📚 相关文档

- **完整需求文档**: [F133第一期需求文档.md](./F133第一期需求文档.md) ⭐⭐⭐ **必读**
- **项目架构设计总览**: [项目架构设计总览.md](./architecture/项目架构设计总览.md)
- **MVP版本UI设计**: [MVP版本UI设计说明.md](./architecture/MVP版本UI设计说明.md)
- **线程架构基线**: [线程架构基线（最终版）.md](./线程架构基线（最终版）.md)
- **消息队列实现**: [消息队列实现与最佳实践.md](./消息队列实现与最佳实践.md)
- **VIP会员功能设计**: [VIP会员与微信扫码功能设计.md](./VIP会员与微信扫码功能设计.md)
<!-- 非MVP：WebSocket实现方案（后续评估） -->
- **F133移植方案**: [F133_KTV移植方案总结.md](./guides/F133_KTV移植方案总结.md)

---

## 🎯 总结

### MVP版本（第一期）功能范围

**包含**：
- ✅ 首页、历史记录、VIP会员中心
- ✅ 搜索、点歌、播放控制
- ✅ 音轨切换、音量控制
- ✅ 历史记录（最多50首）
- ✅ VIP会员功能（会员状态、VIP歌曲标识）
- ✅ 微信扫码点歌（扫码激活、扫码点歌）
<!-- 非MVP：WebSocket长连接（后续评估） -->

**不包含**：
- ❌ 我的收藏
- ❌ 猜你喜欢
- ❌ 语音点歌
- ❌ 唱歌打分

### 技术状态

- ✅ **核心功能已实现** - UI、播放器、网络通信
- ✅ **录音接口已扩展** - 未来可直接启用
- ❌ **录音功能不启用** - MVP版本保持stub实现
- ✅ **架构已就绪** - 未来功能可平滑扩展
- ✅ **消息队列使用标准库** - `std::queue + std::mutex`（MVP阶段）

---

**最后更新**: 2025-12-30  
**状态**: ✅ MVP版本需求整理（最终版）

