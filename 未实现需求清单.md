# KTV 应用未实现需求清单

## 一、构建问题（已解决）

### 1. MSVC 编译错误 ✅
- **问题**：`-external:I` 标志导致标准库头文件（`stdint.h`, `string`, `vector` 等）找不到
- **状态**：✅ 已解决（禁用 external include 机制，使用 `/external-`）
- **解决方案**：在 CMakeLists.txt 顶层添加 `add_compile_options(/external-)`

### 2. SDL2 链接错误 ✅
- **问题**：`SDL_main` 未解析的外部符号
- **状态**：✅ 已修复（在 `main.cpp` 中添加了 `#include <SDL_main.h>` 并将 `main` 改为接受参数）

---

## 二、核心功能未实现

### 1. 播放器集成（PlayerService）
- **当前状态**：只有 mock 实现
- **需要实现**：
  - [ ] 集成 TPlayer API（F133 平台）
  - [ ] 实现真正的播放控制（播放、暂停、停止）
  - [ ] 实现音轨切换（原唱/伴奏）- `TPlayerSwitchAudio`
  - [ ] 实现音量控制 - `TPlayerSetVolume`
  - [ ] 实现播放进度显示
  - [ ] 处理播放完成事件

### 2. M3u8 下载服务（M3u8DownloadService）
- **当前状态**：只有 mock 实现
- **需要实现**：
  - [ ] 解析 m3u8 文件
  - [ ] 下载 ts 文件片段
  - [ ] 存储到本地 hash 目录
  - [ ] 后台下载任务管理
  - [ ] 下载进度通知

### 3. 历史记录持久化（HistoryService）
- **当前状态**：内存实现完成，缺少持久化
- **需要实现**：
  - [ ] 保存历史记录到 JSON 文件
  - [ ] 启动时加载历史记录
  - [ ] 自动保存机制（播放后自动保存）

### 4. Licence 验证（LicenceService）
- **当前状态**：只有占位实现
- **需要实现**：
  - [ ] 从本地文件加载 licence 信息
  - [ ] 调用服务器验证 licence
  - [ ] 试用期管理（最多 N 次试用）
  - [ ] 过期检查
  - [ ] MAC 地址绑定

---

## 三、UI 功能（部分已实现）

### 1. 播放控制栏功能 ✅
- **当前状态**：✅ 已实现基本功能
- **已实现**：
  - ✅ "已点" 按钮：显示已点歌曲队列（`create_queue_page`）
  - ✅ "切歌" 按钮：切换到下一首（调用 `QueueService::getNext()`）
  - ✅ "暂停" 按钮：暂停/恢复播放（调用 `PlayerService::pause/resume`）
  - ✅ "重唱" 按钮：重新播放当前歌曲
  - ✅ "调音" 按钮：打开调音页面（`create_audio_settings_page`）
  - ✅ "设置" 按钮：打开设置页面（`create_settings_page`）
- **待完善**：
  - [ ] "伴唱" 按钮：切换音轨（原唱/伴奏）- 需要 PlayerService 支持音轨切换 API

### 2. 已点列表页面 ✅
- **当前状态**：✅ 已实现
- **已实现**：
  - ✅ 显示已点歌曲队列（`create_queue_page`）
  - ✅ 支持删除已点歌曲
  - ✅ 显示当前播放歌曲标记
- **待完善**：
  - [ ] 支持调整播放顺序（拖拽排序）

### 3. 调音页面 ✅
- **当前状态**：✅ 已实现基本功能
- **已实现**：
  - ✅ 音量调节滑块（0-100）
  - ✅ 升降调调节滑块（-12 到 +12）
  - ✅ 实时显示当前值
- **待完善**：
  - [ ] 实际调用 PlayerService 设置音量和升降调（当前只是 UI）

### 4. 设置页面 ✅
- **当前状态**：✅ 已实现基本功能
- **已实现**：
  - ✅ 网络配置输入框（`create_settings_page`）
  - ✅ Licence 激活按钮（打开激活对话框）
  - ✅ 系统信息显示（版本、平台）
- **待完善**：
  - [ ] 实际保存网络配置
  - [ ] 实现 Licence 验证逻辑

---

## 四、平台相关功能

### 1. F133 平台集成
- **当前状态**：Windows 仿真环境
- **需要实现**：
  - [ ] 切换到 F133 驱动（framebuffer + evdev）
  - [ ] 集成 TPlayer 库
  - [ ] 配置交叉编译工具链
  - [ ] 测试硬件解码

### 2. 中文字体
- **当前状态**：未嵌入
- **需要实现**：
  - [ ] 嵌入 Noto Sans SC 字体
  - [ ] 配置 LVGL 字体系统
  - [ ] 测试中文显示

---

## 五、其他优化

### 1. 错误处理
- [ ] 网络请求失败处理
- [ ] 播放器错误处理
- [ ] 文件 I/O 错误处理

### 2. 性能优化
- [ ] 列表虚拟化（如果列表很长）
- [ ] 图片懒加载
- [ ] 内存使用优化

### 3. 日志和调试
- [ ] 完善日志级别
- [ ] 添加性能日志
- [ ] 添加错误追踪

---

## 优先级建议

### 高优先级（阻塞功能）
1. ✅ 修复 Windows 构建问题（已完成）
2. ✅ 实现播放控制栏功能（已完成基本功能）
3. ✅ 实现已点列表页面（已完成）
4. ✅ 实现调音和设置页面（已完成基本 UI）
5. 实现播放器集成（PlayerService）- 需要 TPlayer API
6. 实现历史记录持久化

### 中优先级（核心功能）
1. 实现 M3u8 下载服务
2. 实现已点列表页面
3. 实现调音页面
4. Licence 验证

### 低优先级（优化和扩展）
1. 设置页面
2. 中文字体嵌入
3. F133 平台集成（最终目标）
4. 性能优化

