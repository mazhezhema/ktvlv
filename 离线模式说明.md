# 离线模式说明

## 当前实现状态

### ✅ 已实现的离线支持

1. **UI 启动不阻塞**
   - 所有页面（首页、历史记录、搜索）都使用 mock 数据作为初始显示
   - 移除了启动时的阻塞网络请求
   - 程序可以在没有网络的情况下正常启动和运行

2. **网络请求超时设置**
   - HTTP 请求默认超时时间：10 秒（在 `config.ini` 中可配置）
   - 超时后自动返回失败，不会无限等待

3. **Mock 数据支持**
   - `src/services/mock_data.cpp` 提供了完整的 mock 数据
   - 包括热门歌曲、历史记录、搜索功能

### 📋 当前行为

**启动时：**
- ✅ 立即显示 UI（使用 mock 数据）
- ✅ 不进行任何网络请求
- ✅ 程序响应正常

**运行时：**
- ✅ 所有 UI 操作都基于 mock 数据
- ✅ 点歌功能使用本地队列（不依赖服务器）
- ✅ 搜索功能使用本地 mock 数据

### 🔄 后续连接服务器后的行为

当网络连接可用后，需要实现：

1. **异步网络请求**
   - 在后台线程执行网络请求
   - 请求完成后更新 UI
   - 不阻塞主线程

2. **数据更新策略**
   - 启动时：先显示 mock 数据，后台加载真实数据
   - 搜索时：先显示本地结果，后台请求服务器
   - 失败时：回退到 mock 数据

3. **网络状态检测**
   - 检测网络连接状态
   - 显示网络状态提示
   - 自动重试机制

## 配置文件

`config.ini` 中的网络配置：
```ini
[network]
base_url = https://mc.ktv.com.cn
timeout = 10  # 网络请求超时时间（秒）
company = mtc
app_name = pad1
platform = 4.4
vn = 1.0.0
```

即使服务器地址配置了，程序也会：
- 启动时不连接服务器
- 使用 mock 数据
- 不会因为网络问题导致程序无响应

## 测试建议

### 离线模式测试
1. 断开网络连接
2. 运行程序
3. 验证：
   - ✅ 程序正常启动
   - ✅ UI 正常显示
   - ✅ 所有功能可用（使用 mock 数据）
   - ✅ 程序响应流畅

### 在线模式测试（未来）
1. 连接网络
2. 配置正确的服务器地址
3. 实现异步网络请求
4. 验证：
   - ✅ 启动时显示 mock 数据
   - ✅ 后台加载真实数据
   - ✅ 数据更新后刷新 UI
   - ✅ 网络失败时回退到 mock 数据

## 代码位置

- **Mock 数据**：`src/services/mock_data.cpp`
- **网络服务**：`src/services/http_service.cpp`
- **歌曲服务**：`src/services/song_service.cpp`
- **UI 显示**：`src/ui/layouts.cpp`（已移除阻塞调用）

---

**当前状态**：✅ 完全支持离线模式，可以在没有网络的情况下正常使用所有 UI 功能。

